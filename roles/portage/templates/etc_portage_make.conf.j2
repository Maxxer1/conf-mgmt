CHOST="x86_64-pc-linux-gnu"

CFLAGS="-O3 -pipe -march={{ target_cpu }}"
CXXFLAGS="${CFLAGS}"
RUSTFLAGS="-C target-cpu={{ target_cpu }} -v"

ACCEPT_KEYWORDS="~amd64"

PORTAGE_NICENESS="19"
L10N="en"

FEATURES="parallel-fetch -config-protect-if-modified"

GENTOO_MIRRORS="https://mirror.netcologne.de/gentoo/"

MAKEOPTS="--quiet -j{{ (ansible_processor_vcpus * 0.8)|int }}"

CPU_FLAGS_X86="{{ cpu_flags_x86 | default("aes avx avx2 f16c fma3 mmx mmxext sse sse2 sse3 sse4_1 sse4_2 ssse3") }}"

ACCEPT_LICENSE="*"

# Save elog, viewable by elogv.
PORTAGE_ELOG_SYSTEM="save" 
PORTAGE_ELOG_CLASSES="warn error info log qa"

# Utilize /var/portage.
PORTAGE_HOME="/var/portage"
PORTAGE_TMPDIR="${PORTAGE_HOME}/tmp"
PORTDIR="${PORTAGE_HOME}/tree"
DISTDIR="${PORTAGE_HOME}/distfiles"
PKGDIR="${PORTAGE_HOME}/packages"

# Some better defaults ...
EMERGE_DEFAULT_OPTS="
    --with-bdeps y
    --binpkg-respect-use y
    --buildpkg-exclude 'virtual/* sys-kernel/*-sources games-*/* app-emulation/emul-linux-*'
    --backtrack=300
"

foobashrc_modules="localpatch striplafiles break_hardlinks"

FEATURES="${FEATURES} ccache"
CCACHE_DIR="/var/portage/tmp/ccache"
CCACHE_SIZE="3G"

VIDEO_CARDS="amdgpu radeonsi radeon intel i965"

RUBY_TARGETS='ruby25'
